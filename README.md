# optionGen Change From [XSAM/optionGen](https://github.com/XSAM/optionGen)
---

optionGen is a tool to generate go Struct option for test, mock or more flexible.

## Installation
```bash
go get -u https://github.com/timestee/optionGen/cmd/optionGen
```

optionGen require [goimports](https://godoc.org/golang.org/x/tools/cmd/goimports) to format code which is generated. So you may confirm that `goimports` has been installed

```bash
go get golang.org/x/tools/cmd/goimports
```

## Example
To generate struct option, you need write a function declaration to tell optionGen how to generate.struct name and "OptionDeclareWithDefault" suffix. In this function, just return a variable which type is `map[string]interface{}`.

The key of the map means option name, and the value of the map should consist of two parts, one for option type(except func type), and the other option default value.

Looks like this:
```go
//go:generate optionGen
func ConfigOptionDeclareWithDefault() interface{} {
	return map[string]interface{}{
		"Sounds": string("Meow"),
		"Food":   (*string)(nil),
		"Walk": func() {
			log.Println("Walking")
		},
	}
}
```

Use `go generate` command to generate option.

Here is the sample result generate by `optionGen`

```go
// Code generated by optionGen. DO NOT EDIT.

package main

import "log"

type Config struct {
	Sounds string
	Food   (*string)
	Walk   func()
}

type ConfigOption func(oo *Config)

func WithSounds(v string) ConfigOption { return func(oo *Config) { oo.Sounds = v } }
func WithFood(v *string) ConfigOption  { return func(oo *Config) { oo.Food = v } }
func WithWalk(v func()) ConfigOption   { return func(oo *Config) { oo.Walk = v } }

func NewConfig(opts ...ConfigOption) *Config {
	ret := newDefaultConfig()
	for _, o := range opts {
		o(ret)
	}
	return ret
}

var defaultConfigOptions = [...]ConfigOption{
	WithSounds("Meow"),
	WithFood(nil),
	WithWalk(func() {
		log.Println("Walking")
	}),
}

func newDefaultConfig() *Config {
	ret := &Config{}
	for _, o := range defaultConfigOptions {
		o(ret)
	}
	return ret
}

```

For more example. see the [example](https://github.com/timestee/optionGen/blob/master/example/cat.go) folder